# 数据模型

## 数据库配置

项目相关配置在 `[project_name]/settings.py` 下

`DATABASES` 字段为[数据库相关配置](https://docs.djangoproject.com/zh-hans/4.0/topics/install/#database-installation)

- django 使用 SQLite(python 内置) 为默认数据库
- 其他数据库，需安装对应的数据库包并修改 `DATABASES.default` 字段下的配置

`INSTALLED_APPS` 字段为应用配置，默认包括

- `django.contrib.admin` -- 管理员站点
- `django.contrib.auth` -- 认证授权系统
- `django.contrib.contenttypes` -- 内容类型框架
- `django.contrib.sessions` -- 会话框架
- `django.contrib.messages` -- 消息框架
- `django.contrib.staticfiles` -- 管理静态文件的框架

`py manage.py migrate` 会根据数据库迁移文件创建必要的数据库表

## 创建模型

```py
# [app_name]/models.py

from django.db import models

class Stars(models.Model):
  # 这里定义字段的类型，数据库会将变量名作为列名
  name = models.CharField(max_length=16)
  path = models.URLField(max_length=200)

```

- 每个模型都是 `django.db.models.Model` 的子类
- 每个字段都是 [`Field`](https://docs.djangoproject.com/zh-hans/4.0/ref/models/fields/) 类的实例，常见的有
  - `BooleanField(**options)`
  - `CharField(max_length=None, **options)`
  - `TextField(**options)`
  - `TimeField(auto_now=False, auto_now_add=False, **options)`
  - `DateField(auto_now=False, auto_now_add=False, **options)`
  - `DateTimeField(auto_now=False, auto_now_add=False, **options)`
  - `DecimalField(max_digits=None, decimal_places=None, **options)`
  - `DurationField(**optrions)`
  - `EmailField(max_length=254, **options)`
  - `FileField(ipload_to='', storage=None, max_length=100, **options)`
  - `FilePathField(path='', match=None, recursive=False, allow_files=True, allow_folders=False, max_length=100, **options)`
  - `FloatField(**options)`
  - `GenericIPAddressField(protocol='both', unpack_ipv4=False, **options)`
  - `ImageField(upload_to=None, height_field=None, width_field=None, max_length=100, **options)`
  - `IntegerField(**options)`
  - `JSONField(encoder=None, decoder=None, **options)`
  - etc... (这里还有很多特定场景的字段类型和表示关系的字段类型)

## 激活模型

Django 中的应用是独立的，可以在多个项目中使用，也可对外进行发布

在使用应用时，需要先添加到项目中

- 在 `[project_name]/settings.py` 中的 `INSTALLED_APPS` 下添加应用
- `INSTALLED_APPS` 中添加的内容为应用入口类的路径

```py
# `[project_name]/settings.py`
INSTALLED_APPS = [
  # 这里 app_name 为需要添加的应用名称
  'app_name.apps.AppNameConfig'
  # 省略了默认配置
]
```

```py
# [app_name]/apps.py
from django.apps import AppConfig

class AppNameConfig(AppConfig):
  default_auto_field = 'django.db.models.BigAutoField'
  name = 'app_name'
```

```shell
# 生产指定应用的数据库迁移文件
py manage.py makemigrations [app_name]

# 将迁移执行的内容以sql的形式输出 (适合阅读)
# 该指令并不会执行数据库迁移，只是输出要执行的语句
py manage.py sqlmigrate [app_name] [migration_name]
```

```shell
# 对所有未迁移的应用执行数据库迁移
py manage.py migrate
```

迁移：该操作可以在开发过程中持续修改数据库结构且无需删除和创建表
