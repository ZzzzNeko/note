[toc]

# 数据处理

## 对象拷贝

```js
// 拷贝
const clone = obj => {
  if (typeof obj !== "object" || obj === null) return obj;
  let ret;
  if (Array.isArray(obj)) {
    ret = [];
    for (let val of obj) {
      ret.push(clone(val));
    }
  } else {
    ret = {};
    for (let key in obj) {
      ret[key] = clone(obj[key]);
    }
  }
  return ret;
};

// const obj1 = {
//     a: {
//         b: {
//             c: ["d"]
//         }
//     }
// };

// console.log(copy(obj1));
```

## 数组扁平

```js
// flat-原生
function flatten(array) {
  return array.flat(Infinity);
}

// flat-递归
function flatten(array) {
  return array.reduce(
    (acc, cur) => acc.concat(Array.isArray(cur) ? flatten(cur) : cur),
    []
  );
}

// flat-迭代
function flatten(array) {
  const result = [];
  const stack = [...array];
  do {
    const head = stack.shift();
    if (Array.isArray(head)) {
      stack.unshift(...head);
    } else {
      result.push(head);
    }
  } while (stack.length);
  return result;
}
```

## 数组去重

```js
// unique-集合
function unique(array) {
  return [...new Set([...array])];
}

// unique-手写
function unique(array) {
  const result = [];
  let index = 0;
  do {
    if (!result.includes(array[index])) {
      result.push(array[index]);
    }
  } while (++index < array.length);
  return result;
}
```

## 类数组转数组

```js
function formatArray(arrlike) {
  return [...arrlike];
  return Array.from(arrlike);
  return Array.prototype.slice.call(arrlike);
}
```

## 数组转树

```js
var menu_list = [
  {
    id: "1-1",
    menu_name: "权限设置",
    menu_url: "setting.permission",
    parent_id: "1",
  },
  {
    id: "1-1-1",
    menu_name: "用户管理列表",
    menu_url: "setting.permission.user_list",
    parent_id: "1-1",
  },
  {
    id: "1-1-2",
    menu_name: "用户管理新增",
    menu_url: "setting.permission.user_add",
    parent_id: "1-1",
  },
  {
    id: "1-1-3",
    menu_name: "角色管理列表",
    menu_url: "setting.permission.role_list",
    parent_id: "1-1",
  },
  {
    id: "1-2",
    menu_name: "菜单设置",
    menu_url: "setting.menu",
    parent_id: "1",
  },
  {
    id: "1-2-1",
    menu_name: "菜单列表",
    menu_url: "setting.menu.menu_list",
    parent_id: "1-2",
  },
  {
    id: "1-2-2",
    menu_name: "菜单添加",
    menu_url: "setting.menu.menu_add",
    parent_id: "1-2",
  },
  {
    id: "2",
    menu_name: "订单",
    menu_url: "order",
    parent_id: 0,
  },
  {
    id: "2-1",
    menu_name: "报单审核",
    menu_url: "order.orderreview",
    parent_id: "2",
  },
  {
    id: "2-2",
    menu_name: "退款管理",
    menu_url: "order.refundmanagement",
    parent_id: "2",
  },
  {
    id: "1",
    menu_name: "设置",
    menu_url: "setting",
    parent_id: 0,
  },
];

function buildTree(list) {
  let temp = {};
  let tree = {};
  for (let i in list) {
    temp[list[i].id] = list[i];
  }
  for (let i in temp) {
    const item = temp[i];
    if (item.parent_id) {
      // 存在父节点
      // 找到父节点添加
      const parent = temp[item.parent_id];
      if (!parent.children) {
        parent.children = {};
      }
      parent.children[item.id] = item;
    } else {
      // 没有父节点
      tree[item.id] = item;
    }
  }
  return { temp, tree };
}
```
